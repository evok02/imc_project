from flask import jsonify, make_response
from flask_restx import Namespace, reqparse, Resource, fields

from ..model.agency import Agency
from ..model.newspaper import Newspaper
from ..model.issue import Issue
from ..model.editor import Editor
from ..model.subscriber import Subscriber

from typing import List, Union, Optional


subscriber_ns = Namespace("subscriber", description="Subscriber related operations")

editor_model = subscriber_ns.model("EditorModel", {
    "name": fields.String(required = True, 
                          help = "The name of the editor"),
    "id": fields.Integer(required = True,
                         help = "The unique identifier of an editor")
})
subscriber_model = subscriber_ns.model("SubscriberModel", {
    "name": fields.String(required = True, 
                          help = "The name of the editor"),
    "id": fields.Integer(required = True,
                         help = "The unique identifier of an editor")
})

@subscriber_ns.route("/")
class SubscriberAPI:
    @subscriber_ns.marshal_list_with(subscriber_model, envelope = "subscribers")
    def get(self):
        return Agency.get_instance().get_subscribers()
    def post(self):
        new_subscriber = Subscriber(paper_id=subscriber_ns.path["id"],
                              name=subscriber_ns.payload['name'])
        Agency.get_instance().add_subscriber(new_subscriber)

        # return the new paper
        return new_subscriber
    
